Option, ECHO=FALSE;
Option, TFS=FALSE;
Option, PSDUMPFREQ=1;
Option, STATDUMPFREQ=1;
Option, INFO=TRUE;
Option, PPDEBUG=FALSE;

Title, string="Cyclotron_Multipacting_Simulation_CIAE_100MeV";

Phi = 0.0; // phase of the cavity

MAXPARTSNUM=1000000;  // if boundary geometry is attached in a simulation upper limit of the number of 
		      // simulation particles can be specified by MAXPARTSNUM, if this number get exceeded in simulation, Parallel-T tracker will stop.

// SECONDARYFLAG = 1: Using Furman-Pivi's model
// SURFMATERIAL=0: surface material is copper (SURFMATERIAL=1 will be stainless steel). 
// NEMISSIONMODE = FALSE will use constant simulation particle approach. 
// The field enhancement factor FNBETA in field emission model set very small to prevent field emission in this study.

DistSurf: DISTRIBUTION, DISTRIBUTION = "SURFACEEMISSION", NPDARKCUR = 0,INWARDMARGIN = 0.0, FNBETA = 0.1, FNMAXEMI = 2,  
                                                          SECONDARYFLAG = 1, NEMISSIONMODE=FALSE, 
 							  VVTHERMAL = 7.268929821*1e5, SURFMATERIAL = 0; 

// Emitted secondary particles will use builtin distribution in Furman-Pivi model, no need to define VVTHERMAL.

DistSurf1: DISTRIBUTION, DISTRIBUTION = "SURFACERANDCREATE",INWARDMARGIN = 0.0, NPDARKCUR = 10000, EINITHR = 0.2; 
							    
ge: GEOMETRY, FGEOM="../10.h5", S=0.0, ZSHIFT=0.631, DISTRS={DistSurf, DistSurf1};


value,{Phi};


// L:		physical element length (real in m)
// VOLT:	field scaling factor (real)
// ELEMEDGE:	physical start of the element on the floor (real in m)
// FREQ:	RF frequency of cavity (real in MHz).

Box: RFCavity, PLENGTH = 1.262, VOLT = 1, GEOMETRY = ge, FMAPFN = "../CyciaeEM.h5",
	       ELEMEDGE =0, FAST=true, FREQ =44.6, LAG = Phi, DX = 0, DY = 0, DZ = 0;

Benchmark: Line = (Box);

Mag: CYCLOTRONVALLEY, FMAPFN = "../CyciaeMagReal.h5", ELEMEDGE =0,DX = 0, DY = 0, DZ = 0;

Benchmark: Line = (Box, Mag);

Fs1:FIELDSOLVER, FSTYPE = NONE, MX = 32, MY = 32, MT = 256,
		 PARFFTX = true, PARFFTY = true, PARFFTT = false,
		 BCFFTX = open, BCFFTY = open, BCFFTT = open,
		 BBOXINCR = 0.1, GREENSF = INTEGRATED;

qb=0.2e-9;
bfreq=300;
bcurrent=qb*bfreq;


beam1: BEAM, PARTICLE = ELECTRON, pc = P0, NPART = 2000, BFREQ = bfreq , BCURRENT = bcurrent, CHARGE =-1;

Select, Line=Benchmark;

track, line= Benchmark, beam=beam1, MAXSTEPS=23000, DT=4e-12, ZSTOP=3;  
 run, method = "PARALLEL-T", beam = beam1, fieldsolver = Fs1, MULTIPACTING=true;
endtrack;


Quit;
