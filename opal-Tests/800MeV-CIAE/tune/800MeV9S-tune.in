/////////////////////////////////////////////////////////////////////////////////////
// input file for tune calculation for the 800 MeV CIAE Ring with 9 sectors and    //
// 5  cavities.                                                                    //
// the initial conditions are obtained from CYCLOP.  //
/////////////////////////////////////////////////////////////////////////////////////
OPTION, ECHO=FALSE;
Option, TFS=FALSE;
Option, PSDUMPFREQ=24500000;
Option, SPTDUMPFREQ = 50;
Option, PSDUMPEACHTURN=false;
Option, PSDUMPLOCALFRAME=false;

TITLE,STRING="OPAL-Cycl for 800 MeV 8 sector Ring";

turns=100;

CALL,FILE="data.dat";

Edes= energy/1000.0; //GeV
r0  = r*10;         //mm
pr0 = pr/644.777462; //m_0*c

frequency=44.4;

gamma = (Edes+PMASS)/PMASS;
beta  = sqrt(1-(1/gamma^2));
gambet= gamma*beta;
P0    = gamma*beta*PMASS;
brho  = (PMASS*1.0e9*gambet) / CLIGHT;

VALUE,{gamma,brho,Edes,beta,gambet};


ring: CYCLOTRON, TYPE="CARBONCYCL", CYHARMON=6, PHIINIT=0.0, PRINIT=pr0, RINIT=r0, SYMMETRY=9.0, RFFREQ=frequency, FMAPFN="opal_sectorfield.dat"; 

l1: LINE = (ring);

Dist1:DISTRIBUTION, DISTRIBUTION=fromfile,FNAME="PartDataTune.dat";

Fs1:FIELDSOLVER, FSTYPE=NONE, MX=32, MY=32, MT=32,
                 PARFFTX=true, PARFFTY=true, PARFFTT=false,
                 BCFFTX=open, BCFFTY=open, BCFFTT=open;

beam1: BEAM, PC=P0, PARTICLE=PROTON, CHARGE=1, SPACECHARGE=false, NPART=2, BCURRENT=0.0, BFREQ= frequency;

SELECT, LINE=l1;

TRACK,LINE=l1, BEAM=beam1, MAXSTEPS=1000*turns, STEPSPERTURN=1000;
RUN, METHOD = "CYCLOTRON-T",BEAM=beam1, FIELDSOLVER=Fs1, DISTRIBUTION=Dist1;
ENDTRACK;
STOP;
