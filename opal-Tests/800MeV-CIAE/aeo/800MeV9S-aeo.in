OPTION, ECHO=FALSE;
/////////////////////////////////////////////////////////////////////////////////////
// input file for single particle track for 800 MeV CIAE Ring with 9 sectors and   //
// 5  cavities.                                                                    //
// the initial conditions are obtained from ???.                                   //
/////////////////////////////////////////////////////////////////////////////////////
OPTION, PSDUMPFREQ=10000000;
OPTION, SPTDUMPFREQ=1;

TITLE,STRING="OPAL-Cycl for 800 MeV 8 sector Ring";

rinf= 644.777462;
turns = 173;
Edes= 0.10;
//myR = 273.08526*10.0; // seo 
//myPr= 51.40758/rinf;
//myR = 273.10*10.0;     // center injection
//myPr= 52.38/rinf;
myR = 272.60*10.0;	  // off center injection
myPr= 52.38/rinf;

frequency=44.4;

phi01 = 71;
phi02 = phi01 + 240;
phi03 = phi02 + 480;
phi04 = phi03 + 480;
phi05 = phi04 + 480;

gamma = (Edes+PMASS)/PMASS;
beta  = sqrt(1-(1/gamma^2));
gambet= gamma*beta;
P0    = gamma*beta*PMASS;
brho  = (PMASS*1.0e9*gambet) / CLIGHT;

VALUE,{gamma,brho,Edes,beta,gambet,PMASS};

rf0:RFCavity, VOLT = 0.9, FMAPFN ="../maincavity.dat", TYPE = "SINGLEGAP", FREQ = 44.4, 
    RMIN = 1400, RMAX = 7400, ANGLE = 14.2, PDIS = 101.582,GAPWIDTH = 600,PHI0 = phi01; 
rf1:RFCavity, VOLT = 0.9, FMAPFN ="../maincavity.dat", TYPE = "SINGLEGAP", FREQ = 44.4, 
    RMIN = 1400, RMAX = 7400, ANGLE = 54.2, PDIS = 101.582,GAPWIDTH = 600,PHI0 = phi02;
rf2:RFCavity, VOLT = 0.9, FMAPFN ="../maincavity.dat", TYPE = "SINGLEGAP", FREQ = 44.4,
    RMIN = 1400, RMAX = 7400, ANGLE = 134.2, PDIS = 101.582,GAPWIDTH = 600,PHI0 = phi03;

rf3:RFCavity, VOLT = 0.9, FMAPFN ="../maincavity.dat", TYPE = "SINGLEGAP", FREQ = 44.4, 
    RMIN = 1400, RMAX = 7400, ANGLE = 214.2, PDIS = 101.582,GAPWIDTH = 600,PHI0 = phi04;

rf4:RFCavity, VOLT = 0.9, FMAPFN ="../maincavity.dat", TYPE = "SINGLEGAP", FREQ = 44.4, 
    RMIN = 1400, RMAX = 7400, ANGLE = 294.2, PDIS = 101.582,GAPWIDTH = 600,PHI0 = phi05;

ring: CYCLOTRON, TYPE="CARBONCYCL", CYHARMON=6, PHIINIT=0.0, PRINIT=myPr, RINIT=myR, SYMMETRY=9.0, RFFREQ=frequency, FMAPFN="../opal_sectorfield.dat";


l1: LINE = (ring, rf0, rf1,rf2,rf3,rf4);
//l1: LINE = (ring, rf1);

Dist1:DISTRIBUTION, DISTRIBUTION=fromfile,FNAME="../PartDatabase.dat";

Fs1:FIELDSOLVER, FSTYPE=NONE, MX=32, MY=32, MT=32,
                 PARFFTX=true, PARFFTY=true, PARFFTT=false,
                 BCFFTX=open, BCFFTY=open, BCFFTT=open;

beam1: BEAM, PC=P0, PARTICLE=PROTON, CHARGE=1, SPACECHARGE=false, NPART=1, BCURRENT=0.0, BFREQ= frequency;

SELECT, LINE=l1;

TRACK,LINE=l1, BEAM=beam1, MAXSTEPS=3000*turns, STEPSPERTURN=3000,TIMEINTEGRATOR="LF-2";
RUN, METHOD = "CYCLOTRON-T",BEAM=beam1, FIELDSOLVER=Fs1, DISTRIBUTION=Dist1;
ENDTRACK;
STOP;
