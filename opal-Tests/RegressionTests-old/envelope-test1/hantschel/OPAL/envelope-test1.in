Option, TFS=FALSE;
Option, ECHO=FALSE;
Option, BET=TRUE;

Title,string="OPAL Slice mode test 1";

Edes=1e-3;
gamma=(Edes+EMASS)/EMASS;
beta=sqrt(1-(1/gamma^2));
gambet=gamma*beta;
P0 = gamma*beta*EMASS;
brho = (EMASS*1.0e9*gambet) / CLIGHT;
value,{gamma,brho,Edes,beta,gambet};

// L:        physical element lenght (real)
// KS:       field scaling factor (real)
// FMAPFN:   field file name (string)
// ELEMEDGE: physical start of the element on the floor (real)
//

FINEG_MSL10: Solenoid, L=0.3, KS=0.2, FMAPFN="FINEG-MSL10.T7", ELEMEDGE=0.5;


FIRF_01: RFCavity, L=0.018, VOLT=100, FMAPFN="FINLB01-RACF.T7", ELEMEDGE=0.0, TYPE="STANDING", FREQ=1498.956, LAG=0.0;

//FINEG_MSL20: Solenoid, L=0.3, KS=-0.2, FMAPFN="FINEG-MSL10.T7", ELEMEDGE=0.03;
//FINEG_MSL30: Solenoid, L=0.3, KS=0.2, FMAPFN="FINEG-MSL10.T7", ELEMEDGE=2;
//FINEG_MSL40: Solenoid, L=0.3, KS=0.2, FMAPFN="FINEG-MSL10.T7", ELEMEDGE=3;

//l1:   Line = (FINEG_MSL10,FINEG_MSL20,FINEG_MSL30,FINEG_MSL40);

l1:   Line = (FINEG_MSL10,FIRF_01);
//l1:   Line = (FINEG_MSL10);

/*
 We can specity ONE distribution
*/

Dist1:DISTRIBUTION, DISTRIBUTION=gauss,
sigmax=  1.0e-03, sigmapx=1.0e-4, corrx=0.5,
sigmay=  2.0e-03, sigmapy=1.0e-04, corry=0.5, 
sigmat=  3.0e-03, sigmapt=1.0e-4, corrt=0.0, pt=1.23, nbin=10;

/*
 We can specity ONE field solver object
*/

Fs1:FIELDSOLVER, FSTYPE=NONE, MX=128, MY=128, MT=128,
		 PARFFTX=true, PARFFTY=true, PARFFTT=true,
		 BCFFTX=open, BCFFTY=open, BCFFTT=open,
     BBOXINCR=1.0, GREENSF=INTEGRATED;


beam1: BEAM, PARTICLE=ELECTRON, GAMMA=gamma, pc=P0, NPART=2, BFREQ=1e11, BCURRENT=0.001, CHARGE=-1;

Select, Line=l1;

track,line=l1, beam=beam1, MAXSTEPS=500, DT=5.0e-12;
 run, method = "PARALLEL-SLICE", beam=beam1, fieldsolver=Fs1, distribution=Dist1;
endtrack;
Stop;
